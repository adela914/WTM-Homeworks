"use strict";

var _ava = _interopRequireDefault(require("ava"));

var _supertest = _interopRequireDefault(require("supertest"));

var _app = _interopRequireDefault(require("../app"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const commentToCreate = {
  text: "It was good!"
};
const restaurantToCreate = {
  name: "Test1",
  location: "Test",
  comments: []
};
(0, _ava.default)("Get list of comments", async t => {
  const restaurantRes = await (0, _supertest.default)(_app.default).post("/restaurants/new").send(restaurantToCreate);
  t.is(restaurantRes.status, 200);
  const restaurantCreated = (await (0, _supertest.default)(_app.default).post("/restaurants/new").send(restaurantToCreate)).body;
  const commentRes = await (0, _supertest.default)(_app.default).post(`/restaurants/${restaurantCreated._id}`).send(commentToCreate);
  t.is(commentRes.status, 200);
  const jsonComments = await (0, _supertest.default)(_app.default).get('/comments');
  t.is(jsonComments.status, 200);
  t.true(Array.isArray(jsonComments.body), 'Body should be an array');
  t.true(jsonComments.body.length > 0);
});
(0, _ava.default)("Create a new comment", async t => {
  t.plan(2); ///first creating a restaurant to leave a comment

  const restaurantRes = await (0, _supertest.default)(_app.default).post("/restaurants/new").send(restaurantToCreate);
  t.is(restaurantRes.status, 200);
  const restaurantCreated = (await (0, _supertest.default)(_app.default).post("/restaurants/new").send(restaurantToCreate)).body;
  const commentRes = await (0, _supertest.default)(_app.default).post(`/restaurants/${restaurantCreated._id}`).send(commentToCreate);
  t.is(commentRes.status, 200);
});
(0, _ava.default)("Delete a new comment", async t => {
  t.plan(5); ///first creating a restaurant

  const restaurantRes = await (0, _supertest.default)(_app.default).post("/restaurants/new").send(restaurantToCreate);
  t.is(restaurantRes.status, 200);
  const restaurantCreated = (await (0, _supertest.default)(_app.default).post("/restaurants/new").send(restaurantToCreate)).body;
  const commentRes = await (0, _supertest.default)(_app.default).post(`/restaurants/${restaurantCreated._id}`).send(commentToCreate);
  t.is(commentRes.status, 200);
  const commentJson = (await (0, _supertest.default)(_app.default).post(`/restaurants/${restaurantCreated._id}`).send(commentToCreate)).body;
  const deleteRestaurant = await (0, _supertest.default)(_app.default).delete(`/comments/${commentJson._id}`);
  t.is(deleteRestaurant.status, 200);
  t.is(deleteRestaurant.ok, true);
  const fetch = await (0, _supertest.default)(_app.default).get(`/comments/${commentJson._id}`);
  t.is(fetch.status, 404);
});
//# sourceMappingURL=/Users/kyunghwa/Desktop/WTM2019/Homeworks/week7/node_modules/.cache/ava/0921bd4ba73535497eabf2df7b24c312.js.map